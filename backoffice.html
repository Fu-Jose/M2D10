<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
      integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
    <title>Netflix</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg my-3 mx-3 d-flex justify-content-between">     
              <div class="left">
                <ul class="navbar-nav">
                  <li>
                    <img
                    id="logo"
                    class="mr-3"
                    src="https://logos-download.com/wp-content/uploads/2016/03/Netflix_logo.png"
                  />
                  <button
                    class="navbar-toggler"
                    type="button"
                    data-toggle="collapse"
                    data-target="#navbarNavDropdown"
                    aria-controls="navbarNavDropdown"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                  >
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  </li>
                  <li class="nav-item active">
                    <a class="nav-link" href="#"
                      >Home <span class="sr-only">(current)</span></a
                    >
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">TV Shows</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Movies</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">Recently Added</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="backoffice.html">My List</a>
                  </li>
                </ul>
              </div>
              <div class="right">
                <ul class="no-bullets row">
                  <li class="nav-item">
                    <img
                      id="search-icon"
                      class="mt-2"
                      src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFM0UymE_pOv__JyhctIGLq9XRRmoZx1Rg3Q&usqp=CAU"
                    />
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">KIDS</a>
                  </li>
                  <li class="nav-item">
                    <img
                      id="notification-icon"
                      class="mt-2"
                      src="https://www.materialui.co/materialIcons/social/notifications_white_192x192.png"
                    />
                  </li>
                  <li class="nav-item">
                    <a href="profile.html"><img
                      id="profile-icon"
                      class="mt-1"
                      src="https://occ-0-173-2581.1.nflxso.net/dnm/api/v6/K6hjPJd6cR6FpVELC5Pd6ovHRSk/AAAABZfW1RUr22fiBWaYExj7CxON4XhbCzdXecA3cogZ0L2umPLeF1G2CRjQOqJ4DsYba55_ydC_mMzPhNI-1lGWzjg.png?r=9fe"
                      alt=""
                    /></a>
                  </li>
                </ul>
              </div>
        </nav>        
    <!-- <div id="page-wrapper" class="container mx-4"> -->
      

      <div class="container row mx-auto">
        <h1>My List</h1>
      </div>
      <div class="container row mx-auto">
          <div class="col mx-auto">
            <div class="col col-md-6 mx-auto">
                <p id="subTitle"></p>
                <form onsubmit="handleSubmit(event)">
                  <div class="form-group">
                    <label for="name">Name</label>
                    <input
                      id="name"
                      type="text"
                      class="form-control"
                      placeholder="Write the name here"
                    />
                  </div>
                  <div class="form-group">
                    <label for="description">Description</label>
                    <textarea
                      id="description"
                      rows="3"
                      class="form-control"
                      placeholder="Add a movie description"
                    ></textarea>
                  </div>
                  <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <label class="input-group-text" for="inputGroupSelect01">Genre</label>
                    </div>
                    <select class="custom-select" id="category">
                      <option selected>Choose...</option>
                      <option value="1">Action</option>
                      <option value="2">Drama</option>
                      <option value="3">Crime</option>
                      <option value="4">Comedy</option>
                      <option value="5">Horror</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="imageUrl">ImageUrl</label>
                    <input
                      id="imageUrl"
                      type="text"
                      class="form-control"
                      placeholder="Insert the image url here"
                    />
                  </div>
                  <div class="form-group">
                    <button class="btn btn-primary" type="submit">
                      Add show
                    </button>
                  </div>
                </form>
              </div>
          </div>

      </div>
      <div id="footer"class="container row mx-auto mt-5">
          <div class="container row d-flex justify-content-between">
              <ul class="no-bullets foot-list">
                  <li>Audio and Subtitles</li>
                  <li>Media Centre</li>
                  <li>Privacy</li>
                  <li>Contact Us</li>
              </ul>
              <ul class="no-bullets foot-list">
                <li>Audio Description</li>
                <li>Investor Relations</li>
                <li>Legal Notices</li>
              </ul>
              <ul class="no-bullets foot-list">
                <li>Help</li>
                <li>Jobs</li>
                <li>Cookie Preferences</li>
              </ul>
              <ul class="no-bullets foot-list">
                <li>Gift Cards</li>
                <li>Terms of Use</li>
                <li>Corporate Information</li>
              </ul>
          </div>

      </div>
    <script
      src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
      integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
      crossorigin="anonymous"
    ></script>
  </body>
  <script>
    const url = "https://striveschool-api.herokuapp.com/api/movies/";
    let id;
    window.onload = async () => {
      console.log("page has been rendered");
      let urlParams = new URLSearchParams(window.location.search);
      id = urlParams.get("id");
      console.log("ID IS", id);
      if (id) {
        document.getElementById("subTitle").innerText = "Edit a movie";
        let response = await fetch(url + id, {
          body: JSON.stringify(),
          headers: {
            "Content-Type": "application/json",
            Authorization:
              "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MDUyMTAwMTg5YzI2ZjAwMTU3ZjljNTciLCJpYXQiOjE2MTU5OTA3ODYsImV4cCI6MTYxNzIwMDM4Nn0.iB1IT2zQKjETNfmxqErhNAC4So3s_iiDL6-WenmxgiA",
          },
        });
        let data = await response.json();
        document.getElementById("name").value = data.name;
        document.getElementById("description").value = data.description;
        document.getElementById("category").value = data.category;
        document.getElementById("imageUrl").value = data.imageUrl;
      } else {
        document.getElementById("subTitle").innerText = "Add a movie";
      }
    };

    const handleSubmit = async (e) => {
      e.preventDefault();
      let myEvent = {
        name: document.getElementById("name").value,
        description: document.querySelector("#description").value,
        category: document.getElementById("category").value,
        imageUrl: document.getElementById("imageUrl").value,
      };

      console.log(myEvent);
      let response;
      try {
        if (id) {
          response = await fetch(url + id, {
            method: "PUT",
            body: JSON.stringify(myEvent),
            headers: {
              "Content-Type": "application/json",
              Authorization:
                "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MDUyMTAwMTg5YzI2ZjAwMTU3ZjljNTciLCJpYXQiOjE2MTU5OTA3ODYsImV4cCI6MTYxNzIwMDM4Nn0.iB1IT2zQKjETNfmxqErhNAC4So3s_iiDL6-WenmxgiA",
            },
          });
        } else {
          response = await fetch(url, {
            method: "POST",
            body: JSON.stringify(myEvent),
            headers: {
              "Content-Type": "application/json",
              Authorization:
                "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2MDUyMTAwMTg5YzI2ZjAwMTU3ZjljNTciLCJpYXQiOjE2MTU5OTA3ODYsImV4cCI6MTYxNzIwMDM4Nn0.iB1IT2zQKjETNfmxqErhNAC4So3s_iiDL6-WenmxgiA",
            },
          });
        }

        if (response.ok) {
          alert(`Movie was ${id ? "edited" : "added"} successfully!`);
          window.location.assign("detail.html");
        } else {
          alert("something went wrong :(");
        }
      } catch (error) {
        console.log(error);
      }
    };
  </script>
</html>
